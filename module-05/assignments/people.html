<!DOCTYPE html>
<html lang="en">
    <body>
        <ul id="people"></ul>
        <script>
            // const xhr = (url, method = "GET") => 
            //     new Promise((resolve) =>{
            //         const xhttp = new XMLHttpRequest();
            //         xhttp.onreadystatechange = function (){
            //         if (this.readyState == 4 && this.status == 200) {
            //         resolve(this.responseXML);
            //     }
            // }
            //     xhttp.open(method,url);
            //     xhttp.send();
            // });

        //     const xhttp = new XMLHttpRequest();
        //     xhttp.onreadystatechange = function (){
        //         if (this.readyState == 4 && this.status == 200) {
        //   displayData(this.responseXML);
        //     }
        // };
        // xhttp.open("GET", "people.xml", true);
        // xhttp.send();

        function stringToNode(html){
            const template = document.createElement(`template`);
            html = html.trim();
            template.innerHTML = html;
            return template.content.firstChild;
        }


        function createPeople(people){
            const content = 
            `<li>
                <article>
                    <p>${people.id}</p>
                    <h2>${people.first} ${people.last}</h2>
                    <p>${people.email}</p>
                    <p>${people.gender}</p>
                    <p>${people.ipadd}</p>
                </article>
             /<li>`;   

                return stringToNode(content);
        }


        function parsePeople(xml){
            const id = 
            xml.getElementsByTagName(`id`)[0].childNodes[0].nodeValue;
            const first = 
            xml.getElementsByTagName(`first_name`)[0].childNodes[0].nodeValue;
            const last =
            xml.getElementsByTagName(`last_name`)[0].childNodes[0].nodeValue;
            const email =
            xml.getElementsByTagName(`email`)[0].childNodes[0].nodeValue;
            const gender =
            xml.getElementsByTagName(`gender`)[0].childNodes[0].nodeValue;
            const ipadd =
            xml.getElementsByTagName(`ip_address`)[0].childNodes[0].nodeValue;

            return{
                id,
                first,
                last,
                email,
                gender,
                ipadd,
            };
        }


        function displayData(xmlDoc){
            const people = xmlDoc.getElementsByTagName(`record`);

            const list = document.getElementById(`people`);

            for(let index = 0; index < people.length; index ++){
                const element = people[index];
                const parsedPeople = parsePeople(element);

                const peopleElement = createPeople(parsedPeople);
                list.appendChild(peopleElement);
            }
        }

        //WITH JUST FETCH

        // fetch('people.xml')
        // .then((response) => response.text())
        // .then((data) => new DOMParser().parseFromString(data, 'text/xml'))
        // .then((data) => displayData(data));


        //WITH JUST ASYNC AWAIT

        // const main = async() => {
        //     const response = await fetch('people.xml');
        //     const data = await response.text();
        //     //or .then((response) => response.text())
        //     const xmlDoc = new DOMParser().parseFromString(data, 'text/xml');
        //     displayData(xmlDoc);
        // }

        //WITH BOTH

        const main = async() => {
            const response = await fetch('people.xml')
            .then((response) => response.text())
            .then((data) => new DOMParser().parseFromString(data, 'text/xml'))
            .then((data) => displayData(data));
        }

        // const main = async() => {
        //     const response = await fetch('people.xml')
        //     const data = await response.text()
        //     .then((data) => new DOMParser().parseFromString(data, 'text/xml'))
        //     .then((data) => displayData(data));
        // }

        //GOTTA CALL THE MAIN function
        main();

        </script>
    </body>
</html>